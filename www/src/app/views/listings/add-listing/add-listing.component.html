<div class="container mt-5">
  <!-- Stepper navigation -->
  <ul class="nav nav-pills mb-4">
    <li class="nav-item me-2" *ngFor="let step of activeSteps()">
      <button
        class="btn"
        [class.btn-primary]="currentStep() === step.id"
        [class.btn-outline-secondary]="currentStep() !== step.id"
        (click)="goToStep(step.id)"
      >
        {{ step.label }}
      </button>
    </li>
  </ul>

  <form [formGroup]="listingForm">
    <!-- STEP 1 : Identit√© + choix -->
    <div *ngIf="currentStep() === 1">
      <div class="mb-3">
        <label class="form-label">Votre besoin</label>
        <select class="form-select" formControlName="need">
          <option [value]="Need.VOYAGEUR">Je suis voyageur</option>
          <option [value]="Need.CHERCHEUR">Je cherche un voyageur</option>
        </select>
      </div>

      <div [formGroup]="identityGroup">
        <div class="mb-3">
          <label class="form-label">Nom</label>
          <input type="text" class="form-control" formControlName="lastName" />
        </div>
        <div class="mb-3">
          <label class="form-label">Pr√©nom</label>
          <input type="text" class="form-control" formControlName="firstName" />
        </div>
        <div class="mb-3">
          <label class="form-label">T√©l√©phone</label>
          <input type="text" class="form-control" formControlName="phone" />
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" formControlName="email" />
        </div>
        <div class="form-check mt-3">
          <input
            type="checkbox"
            class="form-check-input"
            formControlName="isAdult"
          />
          <label class="form-check-label">Je certifie √™tre majeur</label>
        </div>
      </div>

      <button
        class="btn btn-primary mt-3"
        type="button"
        (click)="nextStep()"
        [disabled]="!isStepValid(1)"
      >
        Suivant
      </button>
    </div>

    <!-- STEP 2 : Voyage ou Recherche -->
    <div *ngIf="currentStep() === 2">
      <!-- Voyageur -->
      <div *ngIf="userType === Need.VOYAGEUR" [formGroup]="voyageurGroup">
        <div class="mb-3">
          <label class="form-label">Date de d√©part</label>
          <input
            type="date"
            class="form-control"
            formControlName="departureDate"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Date d‚Äôarriv√©e</label>
          <input
            type="date"
            class="form-control"
            formControlName="arrivalDate"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Kilos disponibles</label>
          <input
            type="number"
            class="form-control"
            formControlName="availableWeight"
          />
        </div>
      </div>

      <!-- Chercheur -->
      <div *ngIf="userType === Need.CHERCHEUR" [formGroup]="chercheurGroup">
        <div class="mb-3">
          <label class="form-label">Date maximale de voyage</label>
          <input
            type="date"
            class="form-control"
            formControlName="maxTravelDate"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Kilos d√©sir√©s</label>
          <input
            type="number"
            class="form-control"
            formControlName="desiredWeight"
          />
        </div>
      </div>

      <button class="btn btn-secondary me-2" type="button" (click)="prevStep()">
        Pr√©c√©dent
      </button>
      <button
        class="btn btn-primary"
        type="button"
        (click)="nextStep()"
        [disabled]="!isStepValid(2)"
      >
        Suivant
      </button>
    </div>

    <!-- STEP 3 : Trajet & prix -->
    <div *ngIf="currentStep() === 3" [formGroup]="commonGroup">
      <div class="mb-3">
        <label class="form-label">Lieu de d√©part</label>
        <input
          type="text"
          class="form-control"
          formControlName="departureLocation"
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Lieu d‚Äôarriv√©e</label>
        <input
          type="text"
          class="form-control"
          formControlName="arrivalLocation"
        />
      </div>
      <div class="mb-3">
        <label class="form-label">Prix au kilo</label>
        <div class="input-group">
          <input
            type="number"
            class="form-control"
            formControlName="pricePerKg"
          />
          <select
            class="form-select"
            formControlName="currencyId"
            style="max-width: 120px"
          >
            <option *ngFor="let currency of currencies" [value]="currency.id">
              {{ currency.code }}
            </option>
          </select>
        </div>
      </div>
      <button class="btn btn-secondary me-2" type="button" (click)="prevStep()">
        Pr√©c√©dent
      </button>
      <button
        class="btn btn-primary"
        type="button"
        (click)="nextStep()"
        [disabled]="!isStepValid(3)"
      >
        Suivant
      </button>
    </div>

    <!-- STEP 4 : Paiement et conditions -->
    <div *ngIf="currentStep() === 4">
      <div [formGroup]="legalGroup" class="form-check mt-3">
        <div class="mb-3">
          <label class="form-label">Moyen de paiement</label>
          <input
            type="text"
            class="form-control"
            formControlName="paymentMethod"
          />
        </div>
        <input
          type="checkbox"
          class="form-check-input"
          formControlName="acceptTerms"
        />
        <label class="form-check-label">
          J‚Äôaccepte les
          <a routerLink="/conditions-utilisation" target="_blank"
            >conditions d‚Äôutilisation</a
          >
        </label>
      </div>

      <button class="btn btn-secondary me-2" type="button" (click)="prevStep()">
        Pr√©c√©dent
      </button>
      <button
        class="btn btn-success"
        type="button"
        (click)="submit()"
        [disabled]="!isStepValid(4)"
      >
        Cr√©er l‚Äôannonce
      </button>
    </div>

    <!-- STEP 5 : Confirmation -->
    <div *ngIf="currentStep() === 5" class="text-center mt-5">
      <h2>F√©licitations ! üéâ</h2>
      <p>Votre annonce a √©t√© cr√©√©e avec succ√®s.</p>
    </div>
  </form>
</div>
